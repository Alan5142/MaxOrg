<div class="grid-container">
  <h1>Panel de administrador</h1>
  <mat-grid-list cols="3" rowHeight="175px">
    <mat-grid-tile [colspan]="mediaObserver.isActive('lt-md') ? 3 : 2" [rowspan]="3">
      <mat-card class="dashboard-card mat-elevation-z3">
        <mat-card-header>
          <mat-card-title>
            Tareas terminadas
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="dashboard-card-content height-100 width-100">
          <div class="chart-container" fxLayout="column" style="overflow-x: auto; overflow-y: hidden">
            <canvas baseChart
                    [datasets]="lineChartData"
                    [labels]="lineChartLabels"
                    [options]="lineChartOptions"
                    [colors]="lineChartColors"
                    [legend]="lineChartLegend"
                    [chartType]="lineChartType"></canvas>
          </div>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile [colspan]="mediaObserver.isActive('lt-md') ? 3 : 1"
                   [rowspan]="mediaObserver.isActive('lt-md') ? 2 : 1">
      <mat-card class="dashboard-card mat-elevation-z3">
        <mat-card-header>
          <mat-card-title>
            tareas terminadas
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="dashboard-card-content">
          <div class="height-100 width-100" fxLayout="column" fxLayoutAlign="center center">
            <mat-progress-spinner [diameter]="mediaObserver.isActive('lt-md') ? 100 : 50"
                                  [value]="tasksInfo.finished*100/tasksInfo.total"
                                  mode="determinate"></mat-progress-spinner>
            <!-- <h2 *ngIf="!mediaObserver.isActive('lt-md')">{{tasksInfo.finished*100/tasksInfo.total | number:'1.0-0'}}%</h2> -->
            <button mat-button (click)="percent_ratio.tasks=!percent_ratio.tasks"><h4>
              {{percent_ratio.tasks ? (tasksInfo.finished + '/' + tasksInfo.total) :
              (tasksInfo.total > 0 ? ((tasksInfo.finished * 100 / tasksInfo.total | number:'1.0-0') + '%') : 'N/A')}}
            </h4></button>
            <!-- <h1 *ngIf="mediaObserver.isActive('lt-md')">{{tasksInfo.finished*100/tasksInfo.total | number:'1.0-0'}}%</h1> -->
          </div>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>
    <mat-grid-tile [colspan]="mediaObserver.isActive('lt-md') ? 3 : 1"
                   [rowspan]="mediaObserver.isActive('lt-md') ? 2 : 1">
      <mat-card class="dashboard-card mat-elevation-z3">
        <mat-card-header>
          <mat-card-title>
            requerimientos funcionales terminados
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="dashboard-card-content">
          <div class="height-100 width-100" fxLayout="column" fxLayoutAlign="center center">
            <mat-progress-spinner [diameter]="mediaObserver.isActive('lt-md') ? 100 : 50"
                                  [value]="reqsInfo.fReqFinished*100/reqsInfo.fReqTotal"
                                  mode="determinate"></mat-progress-spinner>
            <!-- <h2 *ngIf="!mediaObserver.isActive('lt-md')">{{tasksInfo.finished*100/tasksInfo.total | number:'1.0-0'}}%</h2> -->
            <button mat-button (click)="percent_ratio.functionalRequirements=!percent_ratio.functionalRequirements"><h4>
              {{percent_ratio.functionalRequirements ? (reqsInfo.fReqFinished + '/' + reqsInfo.fReqTotal) :
              (reqsInfo.fReqTotal > 0 ? ((reqsInfo.fReqFinished * 100 / reqsInfo.fReqTotal | number:'1.0-0') + '%') : 'N/A')}}
            </h4></button>
            <!-- <h1 *ngIf="mediaObserver.isActive('lt-md')">{{tasksInfo.finished*100/tasksInfo.total | number:'1.0-0'}}%</h1> -->
          </div>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>
    <mat-grid-tile [colspan]="mediaObserver.isActive('lt-md') ? 3 : 1"
                   [rowspan]="mediaObserver.isActive('lt-md') ? 2 : 1">
      <mat-card class="dashboard-card mat-elevation-z3">
        <mat-card-header>
          <mat-card-title>
            requerimientos no funcionales terminados
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="dashboard-card-content">
          <div class="height-100 width-100" fxLayout="column" fxLayoutAlign="center center">
            <mat-progress-spinner [diameter]="mediaObserver.isActive('lt-md') ? 100 : 50"
                                  [value]="reqsInfo.nfReqFinished*100/reqsInfo.nfReqTotal"
                                  mode="determinate"></mat-progress-spinner>
            <!-- <h2 *ngIf="!mediaObserver.isActive('lt-md')">{{tasksInfo.finished*100/tasksInfo.total | number:'1.0-0'}}%</h2> -->
            <button mat-button
                    (click)="percent_ratio.nonFunctionalRequirements=!percent_ratio.nonFunctionalRequirements"><h4>
              {{percent_ratio.nonFunctionalRequirements ? (reqsInfo.nfReqFinished + '/' + reqsInfo.nfReqTotal) :
              (reqsInfo.nfReqTotal > 0 ? ((reqsInfo.nfReqFinished * 100 / reqsInfo.nfReqTotal | number:'1.0-0') + '%') : 'N/A')}}
            </h4></button>
            <!-- <h1 *ngIf="mediaObserver.isActive('lt-md')">{{tasksInfo.finished*100/tasksInfo.total | number:'1.0-0'}}%</h1> -->
          </div>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile [colspan]="mediaObserver.isActive('lt-md') ? 3 : 1" [rowspan]="1">
      <mat-card class="dashboard-card mat-elevation-z3">
        <mat-card-header>
          <mat-card-title>
            Espacio usado
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="dashboard-card-content">
          <div>
            <h1>{{(groupInfo | async)?.size / 1048576 | number: '1.3-3'}}MiB/500MiB</h1>
          </div>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile [colspan]="mediaObserver.isActive('lt-md') ? 3 : 1" [rowspan]="1">
      <mat-card class="dashboard-card mat-elevation-z3">
        <mat-card-header>
          <mat-card-title>
            Numero de miembros
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="dashboard-card-content">
          <div>
            <h1 *ngIf="(groupInfo | async)?.members as members">{{members}} miembro{{members > 1 ? 's' : ''}}</h1>
          </div>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile *ngIf="!mediaObserver.isActive('lt-md')" [colspan]="mediaObserver.isActive('lt-md') ? 3 : 1"
                   [rowspan]="1">
      <mat-card class="dashboard-card mat-elevation-z3">
      </mat-card>
    </mat-grid-tile>

    <mat-grid-tile [colspan]="3" [rowspan]="mediaObserver.isActive('lt-md') ? 7 : 3">
      <mat-card class="dashboard-card mat-elevation-z3">
        <mat-card-header>
          <mat-card-title>
            Opciones
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="dashboard-card-content">
          <div fxFlexAlign="start" *ngIf="(readOnlyService.readOnly | async)">
            <mat-slide-toggle (change)="setReadOnly($event)"
                              fxFlexAlign="start"
                              [checked]="readOnlyService.readOnly | async"
                              #readOnly color="primary" style="width: min-content;"
                              name="readOnly">Solo lectura
            </mat-slide-toggle>
            <button (click)="createDerivedProject()" mat-flat-button class="width-100" color="primary">CREAR PROYECTO
              DERIVADO
            </button>
          </div>
          <div fxLayout="row" fxLayout.lt-md="column" *ngIf="!(readOnlyService.readOnly | async)">
            <form class="options-container" fxFlex="50" fxLayout="column">
              <div fxFlexAlign="start">
                <mat-slide-toggle (change)="setReadOnly($event)"
                                  #readOnly color="primary"
                                  style="width: min-content;"
                                  [checked]="readOnlyService.readOnly | async"
                                  name="readOnly">Solo lectura
                </mat-slide-toggle>
              </div>
              <p class="text-left">Cambiar nombre</p>
              <mat-form-field>
                <input #projectName matInput maxlength="30" placeholder="Nombre del proyecto" type="text" name="name"
                       [value]="(groupInfo | async)?.name">
                <mat-hint>Longitud máxima de 30 caracteres</mat-hint>
              </mat-form-field>
              <button color="primary" type="submit" mat-flat-button
                      (click)="editInfo(readOnly.checked, projectName.value)">
                CAMBIAR NOMBRE
              </button>
              <button color="primary" class="width-100" mat-flat-button (click)="addMembers()">AGREGAR MIEMBROS</button>
              <button (click)="changeDescription()" color="accent" mat-flat-button>CAMBIAR DESCRIPCIÓN</button>
            </form>

            <form class="options-container" fxFlex="50" fxLayout="column" *ngIf="(groupInfo | async) as $groupInfo">
              <div *ngIf="$groupInfo.isRoot" class="width-100">
                <h2 class="width-100">Vincular con repositorio de GitHub</h2>
                <button color="primary" mat-flat-button (click)="openLinkToGitHubDialog()" class="width-100">VINCULAR
                </button>
              </div>
              <div class="width-100" *ngIf="!$groupInfo.isLinkedToDevOps">
                <h2 class="width-100">Vincular con Azure DevOps</h2>
                <button color="primary" mat-flat-button (click)="openVSDevOpsAuth()" class="width-100">VINCULAR</button>
              </div>
              <div *ngIf="$groupInfo.isRoot && $groupInfo.isLinkedToDevOps" class="width-100" fxLayout="column">
                <h2>DevOps</h2>
                <mat-form-field>
                  <input #devOpsOrgName matInput type="text">
                  <mat-label>Nombre de la organización</mat-label>
                </mat-form-field>
                <mat-form-field>
                  <input #devOpsProjectName matInput type="text">
                  <mat-label>Nombre del proyecto</mat-label>
                </mat-form-field>
                <button mat-flat-button color="accent"
                        [disabled]="devOpsOrgName.value.trim() === '' || devOpsProjectName.value.trim() === ''"
                        (click)="changeDevOpsInfo(devOpsOrgName.value, devOpsProjectName.value)">CAMBIAR INFORMACIÓN
                </button>
              </div>
              <div *ngIf="$groupInfo.previousProject">
                <h2>Este proyecto es una continuación a: {{$groupInfo.previousProjectName}}</h2>
                <button mat-flat-button color="primary" [routerLink]="['/project', $groupInfo.previousProject]">REVISAR ANTECESOR</button>
              </div>
            </form>
          </div>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>


  </mat-grid-list>
</div>
